{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/home.css')}}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <script src="{{ url_for('static', filename='js/home.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/setting-bar.js') }}" defer></script>
{% endblock %}

{% block content %}
<div class="container">
    <div id="AlertModalDiv"> 
        {% include "/layout/alert_modal.html" %}
    </div>
</div>

<div class="container mb-4 px-1" id="setting-bar-container">
  <div class="row mx-auto settings-bg-color">
    <div class="collapse settings-bar container-fluid show col-11" id="settingsBar">
      <div class="row justify-content-center">
        <div class="col-auto my-2">
          <button type="button" class="btn btn-outline-primary" onclick="reuploadFiles()">
            <i class="fa-solid fa-arrow-up-from-bracket mr-2"></i> Reupload
          </button>
        </div>
        <div class="col-auto my-2">
          <button type="button" class="btn btn-outline-primary" onclick="exportSinglePDF()">
            <i class="fa-solid fa-file-export"></i> PDF
          </button>
        </div>
        <div class="col-auto my-2">
          <button type="button" class="btn btn-outline-primary" onclick="exportAllPDF()">
            <i class="fa-solid fa-file-export"></i> All Results PDF
          </button>
        </div>
      </div>
    </div>
    <div class="d-flex justify-content-end px-2 col-1 py-3">
      <button id="settingsBarCollapseBtn" class="btn active border-0" type="button" data-bs-toggle="collapse" data-bs-target="#settingsBar" aria-expanded="true" aria-controls="settingsBar">
        <i class="fa-solid fa-gear fa-2x"></i>
      </button>
    </div>
  </div>
</div>

<div id="slide-container" style="display: none;">
  <input type="range" min="1" max="100" value="0" class="slider" id="matchSlider">
  <input type="number" min="1" max="100" value="0" id="matchInput" class="form-control d-inline w-auto">
  <span> Minimum Match %</span>
</div>

<div id="similarity-result" class="container"></div>

<div id="upload-container" class="container mt-1">
  <h2 id="upload-header" class="mb-4">Upload Your .docx  Files</h2>
  <form id="match-form" action="{{ url_for('home') }}" method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    <div class="d-flex flex-row">
      <aside id="file-list" class="flex-column"></aside>
      <div id="drop-zone" class="drop-zone">
        <i class="fa-solid fa-upload fa-5x mb-3 d-block"></i>
        Drag and drop .docx files here or click to upload.
      </div>
      {{ form.files(class="hidden", multiple=True, accept=".docx", required=False) }}
    </div>
    <div class="row m-0">
      {{ form.submit(class="btn btn-primary mt-2", id="submit") }}
    </div>
    <div class="progress-container mt-3">
      <label for="file-status-bar">File Status</label>
      <div class="progress mt-3" id="file-status-bar">
        <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
    </div>
    <div class="progress-container">
      <label for="upload-progress-bar">Upload Progress</label>
      <div class="progress mt-3" id="upload-progress-bar">
        <div id="upload-progress" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
    </div>
  </form>
  
  <form id="visualise-form" class="hidden" action="{{ url_for('visualise') }}" method="POST" enctype="multipart/form-data" target="_blank">
    {{ visualise_form.csrf_token(id="visualise_form_csrf_token") }}
    {{ visualise_form.base_file(accept=".docx", required=False) }}
    {{ visualise_form.compare_file(accept=".docx", required=False) }}
  </form>
</div>
{% endblock %}